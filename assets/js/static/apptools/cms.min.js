/*
------- [ momentum jQuery CMS plugin ] -------

version: 0.0.1
edited: 2/29/12

Â© momentum labs 2012

-------------- [ momentum.io ] ---------------
 */(function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p;e=!1,f={},g={},h=0,j={panel:{commands:{undo:function(){return c.execCommand("undo")},redo:function(){return c.execCommand("redo")},cut:function(){return c.execCommand("cut")},paste:function(){return c.execCommand("paste")},table:function(){return c.execCommand("enableInlineTableEditing")},resize:function(){return c.execCommand("enableObjectResizing")},clip:null,b:function(){return c.execCommand("bold")},u:function(){return c.execCommand("underline")},i:function(){return c.execCommand("italic")},clear:function(){return c.execCommand("removeFormat")},h1:function(){var a;return a=c.selection?c.selection():b.getSelection(),c.execCommand("insertHTML",!1,'<h1 class="h1">'+String(a)+"</h1>")},h2:function(){var a;return a=c.selection?c.selection():b.getSelection(),c.execCommand("insertHTML",!1,'<h2 class="h2">'+String(a)+"</h2>")},h3:function(){var a;return a=c.selection?c.selection():b.getSelection(),c.execCommand("insertHTML",!1,'<h3 class="h3">'+String(a)+"</h3>")},fontColor:function(){var a;return a=prompt("Please enter a hexidecimal color value (i.e. #ffffff)"),c.execCommand("foreColor",!1,a)},fontSize:function(){var a,d;return d=c.selection?c.selection():b.getSelection(),a=prompt("Please enter a desired point size, (e.g. enter 10 for 10pt)"),c.execCommand("insertHTML",!1,'<span style="font-size:'+a+'pt;">'+d+"</span>")},fontFace:null,l:function(){return c.execCommand("justifyLeft")},r:function(){return c.execCommand("justifyRight")},c:function(){return c.execCommand("justifyCenter")},"in":function(){return c.execCommand("indent")},out:function(){return c.execCommand("outdent")},bullet:function(){return c.execCommand("insertUnorderedList")},number:function(){return c.execCommand("insertOrderedList")},indentSpecial:null,lineSpacing:null,link:function(){var a;return a=prompt("What URL would you like to link to?"),c.execCommand("createLink",!1,a)},image:null,video:null},html:['<div id="CMS_wrap">','<div id="CMS_panel" class="fixed panel" style="opacity: 0;">','<div id="CMS_frame" class="nowrap">','<div class="cms_pane" id="buttons">','<div class="cms_subpane">','<h1 class="cms_sp">editing</h1>',"<p>",'<button id="cms_undo" value="undo">undo</button>','<button id="cms_redo" value="redo">redo</button>','<button id="cms_cut" value="cut">cut</button>','<button id="cms_paste" value="paste">paste</button>',"</p>","</div>","<hr/>",'<div class="cms_subpane">','<h1 class="cms_sp">typography</h1>',"<p>",'<select id="cms_headers" class="cms">','<option id="cms_h1" class="h1">Heading 1</option>','<option id="cms_h2" class="h2">Heading 2</option>','<option id="cms_h3" class="h3">Heading 3</option>',"</select>",'<button id="cms_b" value="bold">B</button>','<button id="cms_u" value="underline">U</button>','<button id="cms_i" value="italic">I</button>','<button id="cms_clear" value="clear formatting">clear</button>','<button id="cms_fontColor" value="font color">font color</button>','<button id="cms_fontSize" value="font size">font size</button>',"</p>","</div>","<hr/>",'<div class="cms_subpane">','<h1 class="cms_sp">alignment</h1>','<p style="text-lign:center">','<button id="cms_l" value="left">left</button>','<button id="cms_c" value="center">center</button>','<button id="cms_r" value="right">right</button>',"<br>",'<button id="cms_in" value="indent">&raquo;</button>','<button id="cms_out" value="outdent">&laquo;</button>',"<br>",'<button id="cms_ul" value="unordered list">&lt;ul&gt;</button>','<button id="cms_ol" value="ordered list">&lt;ol&gt;</button>',"</p>","</div>","<hr/>",'<div class="cms_subpane">','<h1 class="cms_sp">interactive</h1>',"<p>",'<button id="cms_link" value="link">add link</button>',"</p>","</div>","</div>",'<div class="cms_pane" id="styles">','<div class="cms_subpane">','<h1 class="cms_sp">styles</h1>',"<p>MIDDLE</p>","</div>","</div>",'<div class="cms_pane" id="assets">','<div class="cms_subpane">','<h1 class="cms_sp">assets</h1>','<div id="upload_wrap">','<div id="upload" class="dragdrop">','<span class="center-text" id="up_content">+</span>',"</div>","</div>","</div>","<hr>",'<div class="cms_subpane">','<h1 class="cms_sp">pop out</h1>',"<p>",'<button id="pop_assets_button" class="pop" name="assets" value="pop out this pane!">pop me out</button>',"</p>","</div>","</div>","</div>",'<div id="CMS_nav">','<a class="scroll" href="#buttons">buttons</a>','<a class="scroll" href="#styles">styles</a>','<a class="scroll" href="#assets">assets</a>',"</div>",'<div id="CMS_panel_footer">&copy; momentum labs 2012</div>',"</div>","</div>"].join("\n")},scroller:{animation:{duration:500,easing:"easeInOutExpo",complete:null},axis:"horizontal",frame:"CMS_frame",init:!1},pop:{position:{bottom:"60px",right:"60px"},animation:{duration:500,easing:"easeInOutExpo",complete:null},init:!1},modal:{initial:{width:"0px",height:"0px",top:b.innerHeight/2+"px",left:b.innerWidth/2+"px"},ratio:{x:.4,y:.4},template:['<div id="[% id %]_container" style="opacity: 0;" class="container">','<div id="[% id %]" style="opacity: 0;" class="modal">','<div id="[% id %]_status"></div>',"<hr>",'<div id="[% id %]_content">',"</div>","<hr>",'<div id="[% id %]_ui"></div>',"</div>","</div>"].join("\n"),rounded:!0,init:!1},overlay:'<div id="m-overlay" class="fixed" style="opacity: 0;"></div>',init:!1},l={init:function(b){return config=a.extend(!0,{},j,b),a("body").append('<div class="fixed panel bigger" id="cms_edit_on" style="vertical-align: middle; left: -305px;top: 10px;width: 300px;text-align: right;padding-right: 10px;opacity: 0;"><span id="cms_span" style="opacity:0;">content editing <span style="color: green;font-weight: bold;">ON</span></span></div>'),setTimeout(function(){a("#cms_span").animate({opacity:1},{duration:450,easing:"easeInOutExpo"}),a("#cms_edit_on").animate({opacity:1,left:"-155px"},{duration:400,easing:"easeInOutExpo",complete:function(){setTimeout(function(){a("#cms_span").animate({opacity:0},{duration:350,easing:"easeInOutExpo"}),a("#cms_edit_on").animate({left:"-290px"},{duration:500,easing:"easeInOutExpo",complete:function(){a("#cms_edit_on").html("&raquo;"),a("#cms_edit_on").css({cursor:"pointer"}),util.bind(a("#cms_edit_on"),"click",function(){o.make(),o.live(),a("#cms_edit_on").html("X"),a("#cms_edit_on").unbind("click"),util.bind(a("#cms_edit_on"),"click",util.wrap(o.destroy,!0))})}})},1750)}})},500),this.each(function(){var b=this,c=a(b);util.bind(c,"click",util.wrap(l.edit,b))})},edit:function(b){var c=a(b),d=c.offset(),h=c.attr("id");f[h]=c.attr("style"),g[h]=c.html(),b.contentEditable=!0,e=!0,c.unbind("click"),over=config.overlay,a("body").append(over),a("#m-overlay").animate({opacity:.75},{duration:400,easing:"easeInOutExpo"}),c.css({"z-index":function(){var a=900+Math.floor(Math.random()*81);return a},position:"absolute"}),c.offset(d),util.isID("CMS_panel")||(o.make(),o.live()),a("#m-overlay").bind({click:util.wrap(l.save,b)})},save:function(b){var c=a(b),d=c.attr("id"),f=c.html(),i=c.data("snippet-keyname")?c.data("snippet-keyname"):"default-key";console.log("RETRIEVING HTML STATE: "+g[d]+"COMPARED TO: "+f),e=!1,b.contentEditable=!1,o.destroy(),console.log("REBINDING EDIT ON "+c),util.bind(c,"click",util.wrap(l.edit,b)),util.isID("CMS_sync")||a("body").append('<div class="cms_message warn" id="CMS_sync" style="opacity: 0;"><div id="sync_loader" class="loader">syncing changes...</div></div>'),a("#m-overlay").animate({opacity:0},{duration:500,easing:"easeInOutExpo",complete:function(){a("#m-overlay").remove(),f!==g[d]&&a("#CMS_sync").animate({opacity:1},{duration:700,easing:"easeInOutExpo",complete:function(){h++,l.sync({snippet_keyname:i,inner_html:f})}})}})},sync:function(b){console.log("SYNC!"),console.log("Change Count: "+h),a.apptools.api.content.save_snippet(b).fulfill({success:function(){h-1==0?(a("#CMS_sync").html("changes saved!"),a("#CMS_sync").removeClass("warn").removeClass("error").addClass("yay"),setTimeout(function(){a("#CMS_sync").animate({opacity:0},{duration:500,easing:"easeInOutExpo",complete:function(){a("#CMS_sync").remove()}})},700),h--):h--},failure:function(c){a("#CMS_sync").html("error syncing page."),a("#CMS_sync").removeClass("warn").addClass("error"),setTimeout(function(){a("#CMS_sync").append('<br><a id="sync_retry" style="pointer: cursor;text-decoration: underline;">retry sync</a>'),util.bind(a("#sync_retry"),"click",util.wrap(l.sync,b))},1500)}})},revert:function(b){var c=obj,d=a(obj).data("snippet-keyname");util.is(d)&&a.apptools.api.content.revert_snippet({snippet_keyname:d}).fulfill({failure:function(){},success:function(b){a(c).html(b.inner_html),a("body").append('<div id="CMS_revert" class="cms_message yay" style="opacity: 0;">changes reverted!</div>'),a("#CMS_revert").animate({opacity:1},{duration:400,easing:"easeInOutExpo",complete:function(){setTimeout(function(){a("#CMS_revert").animate({opacity:0},{duration:500,easing:"easeInOutExpo",complete:function(){a("#CMS_revert").remove()}})})}})}})},refresh:function(){},uploadAsset:function(b){b.preventDefault(),b.stopPropagation(),console.log("File(s) dropped!"),a(b.target).removeClass("hover");var d;d=b.dataTransfer.files;for(var e=0;e<d.length;e++){var f=d[e],g=/image.*/;console.log("WORKING ON FILE "+f.name);if(!f.type.match(g))continue;console.log("FILE TYPE: "+f.type),c.getElementById("upload").innerHTML="";var h=new FileReader;h.onloadend=util.imgPreview,h.readAsDataURL(f)}},placeAsset:function(){}},util={bind:function(a,b,c){var d={};return d[b]=c,a.bind(d)},imgPreview:function(a){var b=a.target.result,d=c.createElement("img");d.classList.add("preview"),d.src=b,c.getElementById("upload").appendChild(d),console.log("RESULTS ARE IN: "+b)},is:function(b){return a.inArray(b,[!1,null,NaN,d,0,{},[],"","false","False","null","NaN","undefined","0","none","None"])===-1?!0:!1},isID:function(a){return String(a).split("")[0]==="#"||c.getElementById(a)!==null?!0:!1},makeDragDrop:function(a){a.addEventListener("dragenter",util.stopEvent,!1),a.addEventListener("dragexit",util.stopEvent,!1),a.addEventListener("dragleave",util.stopEvent,!1),a.addEventListener("dragover",util.stopEvent,!1),a.addEventListener("drop",l.uploadAsset,!1)},stopEvent:function(b){b.preventDefault(),b.stopPropagation(),et=b.target,b.type==="dragenter"?(console.log("event triggered: "+b.type),a(et).addClass("hover")):b.type!=="dragover"&&(console.log("event triggered: "+b.type),a(et).removeClass("hover"))},wrap:function(a){var b=Array.prototype.slice.call(arguments,1);return function(){a.apply(this,b)}}},o={make:function(){var b=config.panel.html;a("body").append(b),a("#CMS_panel").css({bottom:"0px"}),a("#CMS_wrap").css({opacity:1}),a("#CMS_panel").animate({bottom:"60px",opacity:1},{duration:500,easing:"easeInOutExpo"})},live:function(){var b=config.panel.commands,d=c.getElementById("upload");console.log("Enabling scrollable content..."),a(".scroll").each(function(){var b,c,d;b=this,c=a(b),d=String(c.attr("href")).slice(1),c.attr("id","scr-"+d),c.attr("href","javascript:void(0);"),c.data("scroller",{target:d,frame:config.scroller.frame}),a("#"+config.scroller.frame).data("scroller",{axis:"horizontal"}),util.bind(c,"click",util.wrap(scroller.jump,d))}),config=a.extend(!0,{},config,{scroller:{init:!0}}),scroller.classify(config.scroller.frame),console.log("Packaging pop-out content..."),a(".pop").each(function(){var b,c,d;b=this,c=a(b),d=c.attr("name"),c.removeAttr("name"),c.data("pop",{target:d}),util.bind(c,"click",util.wrap(pop.pop,d))}),config=a.extend(!0,{},config,{pop:{init:!0}}),util.makeDragDrop(d),console.log("BINDING PANEL ACTIONS");for(var e in b)axn=b[e],axn!==null&&a("#cms_"+e).bind({click:axn})},die:function(){var b=config.panel.commands;console.log("UNBINDING PANEL ACTIONS");for(var c in b)_axn=b[c],_axn!==null&&a("#cms_"+c).unbind("click")},destroy:function(b){b=!0,a("#m-overlay").unbind(),e===!1&&a("#CMS_panel").animate({opacity:0,bottom:"0px"},{duration:450,easing:"easeInOutExpo",complete:function(){b===!0?a("#CMS_wrap").remove():a("#CMS_wrap").css({opacity:0})}})}},scroller={classify:function(b){var c=a("#"+b),d=c.data("scroller");d.axis==="horizontal"||!util.is(d.axis)?(console.log("Horizontal scroll detected. Adjusting classes..."),a(".cms_pane").removeClass("left").removeClass("clear").addClass("in-table"),c.addClass("nowrap")):d.axis==="vertical"&&(console.log("Vertical scroll detected. Adjusting classes..."),c.removeClass("nowrap"),a(".cms_pane").removeClass("in-table").addClass("left").addClass("clear"))},jump:function(b,c,d){util.is(d)&&(d.preventDefault(),d.stopPropagation());var e,f,g=a("#"+config.scroller.frame),h=g.data("scroller"),i=util.is(c)?a.extend({}.config.scroller.animation,{complete:c}):config.scroller.animation;console.log("Scrolling to #"+b),f_o=g.offset(),f=a("#"+b).offset(),h.axis==="vertical"?(diff=Math.floor(f.top-f_o.top),g.animate({scrollTop:"+="+diff},i)):h.axis==="horizontal"&&(diff=Math.floor(f.left-f_o.left),g.animate({scrollLeft:"+="+diff},i))}},pop={pop:function(b,c){var d,e,f,g,h,i,j,k,l;k=config.pop.position,e=a("#"+b),i="pop_"+b,g=i+"_button",d=a("#"+g),h=e.html(),l=e.prev().attr("id"),d.unbind("click"),f=a.extend({},config.pop.animation,{complete:function(){e.remove(),a("#"+g).html("pop back in"),util.bind(a("#"+g),"click",util.wrap(pop.reset,b,"CMS_frame"))}}),console.log("OHHHHHHHHHHHH SNAP ITS _ANIM: "+f.complete),console.log("POPPING #"+b+" OUT TO #"+i+" AND REBINDING #"+g),j='<div id="'+i+'" class="fixed panel" style="opacity: 0;">'+h+"</div>",a("body").append(j),a("#"+i).css({bottom:"0px",right:k.right,"z-index":989}),a("#"+i).animate({bottom:k.bottom,opacity:1},f),scroller.jump(l)},reset:function(b,c){if(c===!1||!util.is(c))a("#pop_"+b).remove();else{var d,e,f,g,h,i;g="pop_"+b,d=a("#"+c),f=g+"_button",a(f).unbind("click"),e=a.extend({},config.pop.animation,{complete:function(){a("#"+g).remove(),a("#"+f).html("pop back in"),util.bind(a("#"+f),"click",util.wrap(pop.pop,b,"CMS_frame"))}}),h=a("#"+g).html(),i='<div class="cms_pane" id="'+b+'">'+h+"</div>",d.append(i),a("#"+g).animate({bottom:0,opacity:0},e),console.log("CONTENT REINSERTED: #"+b),scroller.classify(config.scroller.frame),scroller.jump(b)}}},a.fn.cms=function(b){if(l[b])return l[b].apply(this,Array.prototype.slice.call(arguments,1));if(typeof b=="object"||!b)return l.init.apply(this,arguments);a.error("Method "+b+" does not exist on the selected object.")}})(jQuery,window,document);